# Restful API Design

## Start Task

### (Native) curl -X POST http://localhost:8091/egress/v1/{app_id}/tasks \
    -H "Content-Type: application/json" \
    -d '{
      "request_id": "m2d3k03l",
      "cmd": "record",
      "payload": {
        "layout": "flat",
        "channel": "egress_test",
        "access_token": "007eJxt9VMp+//+i9SOE",
        "workerUid": 42,
        "users": ["user1", "user2"],
        "filename_pattern": "file_output", // Support regexp(date, time, region)
        "format": "hls",
        "video": {
            "width": 1280,
            "height": 720,
            "frameRate": 30,
            "bitrate": 1000
        },
        "audio": {
            "sampleRate": 48000,
            "channels": 2,
            "bitrate": 128
        }
      }
    }'

### (Web) curl -X POST http://localhost:8091/egress/v1/{app_id}/tasks \
    -H "Content-Type: application/json" \
    -d '{
      "request_id": "m2d3kw3l",
      "cmd": "record",
      "payload": {
        "layout": "freestyle",
        "url": "http://your_freestyle_canvas.good.example",
        "filename_pattern": "file_output", // Support regexp(date, time, region)
        "webGL": false,
        "format": "hls",
        "video": {
            "width": 1280,
            "height": 720,
            "frameRate": 30,
            "bitrate": 1000
        },
        "audio": {
            "sampleRate": 48000,
            "channels": 2,
            "bitrate": 128
        }
      }
    }'

### Response
    {
        "request_id": "m2d3k03l",
        "task_id": "1ta5k3552",
        "status": "ENQUEUED",
    }

## Stop Task

### curl -X POST http://localhost:8091/egress/v1/{app_id}/tasks/{task_id}/stop \
    -H "Content-Type: application/json" \
    -d '{
      "request_id": "2yui23k5",
    }'    

### Response

```json
{
    "task_id": "1ta5k3552",
    "status": "SUCCESS",
}
```

## Get Task Status

### curl -X GET http://localhost:8091/egress/v1/{app_id}/tasks/{task_id}    
    -H "Content-Type: application/json"
    -d '{
      "request_id": "1yu323k5",
    }'

### Response

```json
{
    "task_id": "1ta5k3552",
    "status": "PROCESSING",
    "payload": {
        "layout": "flat",
        "channel": "egress_test",
        "users": ["user1", "user2"],
        "files": ["file_output", "file_output2"], // Files generated by this task
        "format": "hls",
        "video": {
            "width": 1280,
            "height": 720,
            "frameRate": 30,
            "bitrate": 1000
        },
        "audio": {
            "sampleRate": 48000,
            "channels": 2,
            "bitrate": 128
        }
    }
}
```
